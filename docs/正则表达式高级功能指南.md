# 正则表达式配置与分组替换指南

## 1. 功能概述
在元项目和模版配置中，文本类型的配置项支持使用正则表达式进行精确匹配和替换。
新增的**分组捕获与替换**功能允许用户利用正则表达式的括号分组 `(...)` 特性，指定仅替换匹配内容中的某一部分（如保留引号、保留前缀后缀等），从而极大提高了替换的灵活性和安全性。

## 2. 用户使用说明

### 2.1 基本正则匹配
在配置面板的 "正则表达式" (Regex) 输入框中输入标准的 JavaScript 正则表达式。
例如：`version: "1.0.0"`

### 2.2 分组捕获
若需要仅替换版本号 `1.0.0` 而保留 `version: "` 和 `"`，可以使用括号将需要保留或定位的部分和需要替换的部分分开。
例如：`version: "(.*?)"`

此时，系统会自动检测到正则表达式中包含 1 个捕获组。

### 2.3 选择替换目标 (Target Group)
当正则中包含捕获组时，界面会自动显示 "Target Group" 下拉选择框：
- **Group 0 (Whole Match)**: 默认行为，替换整个匹配到的字符串（即 `version: "1.0.0"` 被替换为 `Target Value`）。
- **Group 1**: 仅替换第一个括号捕获的内容（即 `1.0.0` 被替换为 `Target Value`，最终结果保留 `version: "` 和 `"`）。

### 2.4 示例
假设原始文本为：
```javascript
export const AppConfig = {
  apiUrl: "https://api.dev.com",
  timeout: 5000
};
```

**需求**：将 `https://api.dev.com` 替换为 `https://api.prod.com`。

**配置方式 1 (无分组 - 需重写周边字符)**:
- 正则: `apiUrl: ".*?"`
- 替换值: `apiUrl: "https://api.prod.com"`
- 缺点: 需要在替换值中重复写 `apiUrl: "`。

**配置方式 2 (使用分组 - 推荐)**:
- 正则: `apiUrl: "(.*?)"`
- Target Group: `Group 1`
- 替换值: `https://api.prod.com`
- 结果: `apiUrl: "https://api.prod.com"`
- 优点: 替换值仅需关心核心内容。

## 3. 开发者指南

### 3.1 实现原理
前端利用 `RegExp.prototype.exec` 或 `String.prototype.matchAll` 获取匹配结果及分组索引。
- **UI 渲染**: 使用 `react-syntax-highlighter` 自定义渲染器，结合 `regex` 的 `d` 标志（Indices）或手动计算索引，在预览框中高亮显示选中的分组。
- **数据存储**: `VersionConfig` 和 `TemplateModuleConfig` 实体新增 `groupIndex` 字段 (int, default 0) 存储用户的选择。

### 3.2 核心接口
**VersionConfig Entity**:
```typescript
@Column({ type: 'int', nullable: true, default: 0 })
groupIndex?: number;
```

**TemplateModuleConfig Entity**:
```typescript
@Column({ type: 'int', nullable: true, default: 0 })
groupIndex: number;
```

### 3.3 扩展接口
若需支持更复杂的替换逻辑（如多组组合替换），可扩展 `groupIndex` 为 `groupIndices` 数组或 `replacementPattern` 模板字符串（如 `$1${newValue}$3`）。目前仅支持单一目标分组替换。
